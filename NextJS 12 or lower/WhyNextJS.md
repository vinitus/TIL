# Next.js

왜 써야할까? 어떤 것일까?

NextJS 공식 홈페이지에 다르면 NextJS는 프로덕션 앱 제작을 위한 React 프레임워크이다.

**? 리액트와는 뭐가 다를까**

React는 애초에 라이브러리이다. 결국에는 React는 JavaScript에서 라이브러리로 React를 import하여 사용하는 것이다. 리액트는 UI, 컴포넌트, 상태 등등에만 초점을 맞추고 있다. 더 많은 기능인 SPA에서의 라우팅 등을 사용하려면 라이브러리를 새로 추가해야한다. 하지만, NextJS에서는 이미 내장되어있다. -> 즉, 프레임워크와 라이브러리는 규모 자체가 다르다.
<br>

**? 왜 프로덕션 용인가**

React에서 쉽게 사용하지 못하거나 못하는 기능들을 쉽게 사용할 수 있다.

계속 말하게되는 Router, SSR, SSG 등등이 있다.

## 그래서 왜 써야할까?

React 홈페이지에서 React를 설명할 때,

> A JavaScript library for building user interfaces

라고 한다. 즉, UI를 위한 라이브러리이다. 때문에, 우리는 리액트를 사용하여 웹 프로젝트를 개발할 때 여러 라이브러리를 조합해야한다. React 자체도 이미 라이브러리인데, 이것만으로하는 해결할 수 없는, 혹은 귀찮은 문제들을 해결하기 위해 라이브러리들을 또 도입한다.

그렇게 라이브러리를 도입하고 조합하다보면 문제들이 생긴다. 예를 들어, react-router-dom의 loader에서는 훅을 사용할 수 없어서, redux나 recoil의 상태들을 가져올 수 없었다. 이를 해결하기 위해, react-query를 도입하고, queryClient 자체를 loader에 고차함수로 넘겨서 이를 해결한 적이 있다.

라이브러리 간의 문제를 해결하려면, 다른 라이브러리를 대체하거나 직접 해당 라이브러리와 유사하게 만들거나 해야한다..
또한, 서드 파티 라이브러리들을 계속 사용하다보면, React의 발전에 발맞추지 못하는 경우도 생겼다.

그런 React의 문제를 해결하기 위해, 나머지 부분들을 다 채워주는 framework를 만들었다. 그것이 바로 NextJS이다.

NextJS 팀에 따르면, 하나의 웹 어플리케이션을 만들기 위해서는 다음것들이 필요하다고 말한다.

- User Interface
- Routing
- Data Fetching
- Rendering
- Integrationsh
- Infrastructure
- Performance
- Scalability
- Developer Experience

React는 UI에 집중한 라이브러리지만, NextJS는 프레임워크이기에 여러 기능들을 NextJS에 담았다. 그 많은 기능 중 하나가 Rendering일 뿐이다.

## 중요한 기능

1. SSR

를 살펴보기 전에 앞서, CSR이 나와야한다.

**CSR**

React는 기본적으로 CSR으로 된 웹 어플리케이션을 만든다. CSR은 Client Side Rendering의 약자로써 클라이언트에서 렌더링한다는 것이다.

React앱을 개발하다보면, index.html이란 HTML 파일이 있는데, 이 사이에는 div태그만 존재하고 아무것도 없다.

React는 이 빈 index.html을 채우기 위해, React 라이브러리를 통해 만든 컴포넌트 등을 번들 파일로 묶고, 클라이언트 측에서 이를 해석하여 HTML DOM을 그리고, CSS를 추가하고 렌더링하는 것이다.

그렇기에 CSR, Client Side Rendering이라는 것이다.

이는, 서버 측에서는 좋다. 빈 html 문서와 JS 파일을 전달하기만 하면, 클라이언트가 알아서 이를 렌더링하기 때문이다.

하지만, 2가지 큰 문제점이 있다.

**1. 첫 렌더링시 빈 페이지다.**

클라이언트가 파일을 받아오는 과정은 다음과 같다.

```
index.html -> 필요한 정적 파일들
```

즉, 아무것도 없는 index.html만을 먼저 가져오기 때문에, 아무것도 없는 웹 문서가 보이게 된다. 브라우저가 필요한 JS파일을 받아오고, 이를 파싱하고 렌더링하기 전까지 사용자는 빈 화면만을 봐야한다.

**2. 검색 엔진 최적화에서 문제가 생긴다.**

검색 엔진은 우리 사이트에 방문했을 때, JS에 대한 처리를 하지 않는다. 그렇게 되면 비어있는 index.html 파일만을 보고 나간다는 것이다. 그래서 검색 엔진에 우리 도메인에 대한 어떤 정보도 등록할 수 없을 것이다.

이 중에서 2번째가 가장 크다. 우리는 프로덕션을 만들고 이를 통해, 누군가가 웹 페이지에 들어와서 우리의 비즈니스를 사용하길 바라는데, 검색 엔진에 등록되지 않으면 검색에서 우리 페이지가 나올 확률이 줄어든다.

**SSR**

두 문제점을 해결하기 위한 것이다. SSR은 Server Side Rendering의 약자로, 서버에서 렌더링한 HTML문서를 받아오는 것이다. 서버에서 NextJS의 파일들을 파싱하여 HTML 문서로 만들어서 클라이언트로 보내는 것이다. 클라이언트는 HTML을 받은 다음, 다른 페이지에 대한 정보가 담긴 번들링 파일을 다운로드한다. 그 이후의 웹 어플리케이션 탐험은 클라이언트 측에서 렌더링하는 것이다.

이런 방식은 위의 문제를 해결하였다.

**빈 페이지에 대한 문제 해결**

처음으로 받는 html 파일은 서버가 만든 html파일이다. 비어있지 않고 JSX를 해석하여 만든 html 파일이기 때문에, 우리가 만들고 채워놓은 데이터들이 담겨있다. 그래서 브라우저는 이 HTML 파일을 바로 파싱하여 렌더링을 하고, 다른 페이지에 대한 정보가 담긴 번들링 파일을 다운로드하기 때문에 빈 페이지 문제를 해결했다.

**검색 엔진 최적화**

첫 페이지는 비어있는 HTML이 아닌 데이터가 담기고 태그가 형성된 HTML 파일이기에 검색 엔진은 이를 들여다볼 수 있다. 때문에, 검색 엔진은 우리 사이트에서 정보를 얻어갈 수 있고, 추후 사용자가 해당 검색 사이트에서 우리 사이트에 대한 정보를 검색하면, 우리 사이트가 노출될 수 있다.

2. App Routing

NextJS의 유용한 기능으로써, 파일 경로에 기반한 라우팅을 한다.

pages라는 디렉토리 밑에 React 컴포넌트들을 사용함으로써 자동적으로 라우팅을 한다. 이를 통해, 추가적인 라이브러리나 코드들(History API) 등을 사용하지 않아도 되고, 파일 디렉토리가 곧 Pathname에 해당하니, 개발하기 편하다.
